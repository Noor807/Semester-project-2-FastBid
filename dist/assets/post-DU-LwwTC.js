import{f as $}from"./singleListRead-2w0x1GBA.js";import{u as k}from"./loginAdmin-CrNTEl2x.js";import{A as N,b as A}from"./constants-D-ym1ySC.js";import{t as r}from"./toastMsg-pxLBbmNp.js";import{g as P}from"./higherBider-DIwdkbzu.js";import"./logout-Bp4xtVrQ.js";function H(o){const n=document.querySelector("#AuctionDetailContainer");if(!n){console.error('No element with id "AuctionDetailContainer" found.');return}const{title:t="Untitled Auction",description:a="No description available",tags:s=[],media:e=[],seller:i="unknown",bids:c="0",created:d="Date",updated:p="Date",endsAt:m="Date",_count:D={bids:0}}=o||{};n.innerHTML="";const g=document.createElement("img");e&&e.length>0&&(g.src=e[0].url||"",g.alt=e[0].alt||"No description"),g.className="w-full h-96 object-cover mb-6";const f=document.createElement("div");f.className="flex flex-col md:flex-row gap-6 md:gap-7";const y=document.createElement("div");y.className="flex-1",y.appendChild(g);const l=document.createElement("div");l.className="flex-1";const E=document.createElement("h2");E.className="text-xs font-bold ml-5 text-gray-800 mb-4",E.textContent=t,l.appendChild(E);const x=document.createElement("p");x.className="text-xs text-gray-700 ml-5 mb-4",x.textContent=s.length>0?`Tags: ${s.join(", ")}`:"No tags available",l.appendChild(x);const w=document.createElement("p");w.className=" text-gray-700 ml-5  mb-4",w.textContent=a,l.appendChild(w);const C=document.createElement("p");C.className=" text-gray-800 font-semibold ml-5 mb-2",C.textContent=`Seller: ${i.name||"Unknown Seller"}`,l.appendChild(C);const v=document.createElement("p");v.className=" text-gray-700 font-semibold ml-5 mb-2",v.textContent=`Created: ${d?d.slice(0,10):"Unknown Date"}`,l.appendChild(v);const I=document.createElement("p");I.className=" text-gray-700 font-semibold ml-5 mb-2",I.textContent=`Ends at: ${m?m.slice(0,10):"Unknown Date"}`,l.appendChild(I),f.appendChild(y),f.appendChild(l),n.appendChild(f);const h=document.createElement("p");h.id="bidHistory",h.className="text-sm ml-5 font-bold text-gray-600 hover:text-blue-800 mt-6 cursor-pointer hover:underline",h.textContent=`Bids: ${D.bids}`,n.appendChild(h)}function T(){const n=new URLSearchParams(window.location.search).get("post");n?fetchAndRenderSingleAuction(n):console.error("Auction ID is missing in the URL.")}document.addEventListener("DOMContentLoaded",T);async function U(o,n,t){if(!o||!n||n<=0||!t)throw new Error("Invalid parameters for bid request.");const a=`${N}/${o}/bids`,s={"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Noroff-API-Key":A};try{const e=await fetch(a,{method:"POST",headers:s,body:JSON.stringify({amount:n})});if(!e.ok){const c=await e.text();throw console.error(`Failed to place bid. Status: ${e.status}, Error: ${c}`),new Error(`Failed to place bid. Status: ${e.status}, Error: ${c}`)}const i=await e.json();return{success:!0,message:"Bid placed successfully!"}}catch(e){return console.error("Error placing bid:",e),{success:!1,message:e.message}}}async function j(o,n,t){const a=parseFloat(localStorage.getItem("credit"))||0,s=localStorage.getItem("token");if(!s){r("You need to log in to place a bid.","alert");return}if(!t||t<=0){r("Please enter a valid bid amount.","alert");return}if(t<=n){r(`Your bid must be higher than ${n}.`,"alert");return}if(t>a){r("You do not have enough funds to place a bid.","alert");return}try{const e=await U(o,t,s);e?r(e.message,"success"):r(`Failed to place bid: ${e.message}`,"error")}catch{r("There was an log placing your bid. Please try again.","error")}}async function F(o){const n=document.createElement("div");n.id="bidHistoryModal",n.className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden";const t=document.createElement("div");t.className="bg-white p-4 rounded-lg w-96 max-h-[60vh] overflow-y-auto shadow-lg";const a=document.createElement("button");a.innerText="Close",a.className="text-red-500 font-bold float-right",a.onclick=()=>n.style.display="none";const s=o.sort((e,i)=>i.amount-e.amount);t.appendChild(a),s.forEach(e=>{const i=document.createElement("div");i.className="flex justify-between items-center w-full border-b py-2 md:py-4";const c=document.createElement("div");c.className="flex items-center space-x-4";const d=document.createElement("img");d.className="w-16 h-16 rounded-full md:w-20 md:h-20",d.src=e.bidder.avatar.url||"default-avatar.png",d.alt=`${e.bidder.name}'s avatar`;const p=document.createElement("p");p.className="text-xs md:text-base font-semibold",p.innerText=e.bidder.name,c.appendChild(d),c.appendChild(p);const m=document.createElement("p");m.className="text-xs md:text-base",m.innerHTML=`Bid amount: <span class="font-bold">${e.amount}</span>`,i.appendChild(c),i.appendChild(m),t.appendChild(i)}),n.appendChild(t),document.body.appendChild(n),document.getElementById("bidHistory").addEventListener("click",()=>{n.style.display="flex"})}async function M(o,n){try{const t=`${N}/${o}`,a={"Content-Type":"application/json",Authorization:`Bearer ${n}`,"X-Noroff-API-Key":A},s=await fetch(t,{method:"DELETE",headers:a});if(!s.ok){const e=await s.json();throw new Error(e.message||"Failed to delete auction listing.")}return{success:!0,message:"Post deleted successfully"}}catch(t){throw console.error("Error deleting auction listing:",t),t}}async function O(o){o.preventDefault();const t=o.target.dataset.id,a=localStorage.getItem("token");if(!t){console.error("listID not found.");return}if(confirm("Are you sure you want to delete this list?"))try{const e=await M(t,a);e?(sessionStorage.setItem("deleteList",!0),window.location.href="/"):(console.error("Failed to delete list:",e.error),r("Error: Could not delete the list.","error"))}catch(e){console.error("Unexpected error:",e),r("Error: Could not delete the list.","error")}}k();const q=new URLSearchParams(window.location.search),u=q.get("singleList"),b=await $(u);async function R(o){const n=JSON.parse(localStorage.getItem("adminUser"));if(!n)return;const t=document.getElementById("adminAction");n.name!==o.seller.name?t.classList.add("hidden"):(t.classList.remove("hidden"),t.classList.add("flex"))}R(b.data);const{highestBid:L}=P(b.data);document.getElementById("highestBid").textContent=`${L}$`;H(b.data);const S=document.querySelector(".del-btn");S&&(S.setAttribute("data-id",u),S.addEventListener("click",O));const B=document.querySelector(".edit-btn");B&&B.addEventListener("click",()=>{window.location.href=`/post/edit/?post=${u}`});const Y=document.getElementById("bidHistory");Y.addEventListener("click",F(b.data.bids));const K=document.getElementById("hamburger-btn"),_=document.getElementById("navbar-links");K.addEventListener("click",()=>{_.classList.toggle("hidden")});const z=localStorage.getItem("trigger");if(z==="true"){const o=document.getElementById("bidHistory");o?o.click():console.warn("Bid history button not found"),localStorage.removeItem("trigger")}document.getElementById("placeBid").addEventListener("submit",async o=>{o.preventDefault();let n=document.getElementById("bid-amount").value;const t=parseInt(n,10);let a=parseFloat(localStorage.getItem("credit"))||0;if(!u||!t){console.error("Post ID or bid amount is missing");return}await j(u,L,t),a-=t,localStorage.setItem("credit",a)});sessionStorage.getItem("updatedSuccess")==="true"&&(r("List has been updated successfully","success"),sessionStorage.removeItem("updatedSuccess"));

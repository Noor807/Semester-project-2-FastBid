import{p as i}from"./authUtils-C1C3arbU.js";import{a as c,b as d}from"./constants-BFXYqvjv.js";async function l(o){if(!o)throw new Error("User identifier is required.");const a=`${c}/${o}`,e=i();try{const r=await fetch(a,{method:"GET",headers:e});if(!r.ok){const s=(await r.json()).message||"Failed to fetch auction profile.";throw console.error(`Error ${r.status}: ${s}`),new Error(s)}const t=await r.json();if(!t||!t.data||typeof t.data.credits>"u")throw new Error("Invalid profile data received. Missing or malformed credits field.");const{credits:n}=t.data;localStorage.setItem("credit",n)}catch(r){throw console.error("Error fetching auction profile:",r.message||r),r}}async function f({email:o,password:a}){try{const e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:a})});if(!e.ok){const n=await e.json();throw new Error(n.message||"Login failed")}const r=await e.json();localStorage.setItem("token",r.data.accessToken);const t=r.data;return localStorage.setItem("adminUser",JSON.stringify(t)),await l(r.data.name),r}catch(e){throw console.error("Error during login:",e),e}}async function g(o){o.preventDefault();const a=o.target.email.value,e=o.target.password.value;try{const r=await f({email:a,password:e});sessionStorage.setItem("loggedIn","true"),window.location.href="/"}catch(r){console.error("Login failed:",r),alert("Login failed. Please check your credentials and try again.")}}const m=document.forms.login;m.addEventListener("submit",g);

import{f as N}from"./singleListRead-Cx7jcxUc.js";import{u as D}from"./loginAdmin-ii201TkH.js";import{A as S}from"./constants-BFXYqvjv.js";import{p as B}from"./authUtils-BlpDD4MX.js";import{t as s}from"./toastMsg-pxLBbmNp.js";import{s as A}from"./hamburgerMenu-Mj8nOhEq.js";import{g as $}from"./higherBider-DIwdkbzu.js";function L(t){const e=document.querySelector("#AuctionDetailContainer");if(!e){console.error('No element with id "AuctionDetailContainer" found.');return}const{title:n="Untitled Auction",description:a="No description available",tags:o=[],media:r=[],seller:i={name:"Unknown Seller"},bids:m="0",created:l="Date",updated:p="Date",endsAt:d="Date",_count:I={bids:0}}=t||{};e.innerHTML="";const u=document.createElement("img");r&&r.length>0&&(u.src=r[0].url||"path/to/placeholder-image.jpg",u.alt=r[0].alt||"No description available"),u.className="w-full h-96 object-cover mb-6",u.loading="lazy";const f=document.createElement("div");f.className="flex flex-col md:flex-row gap-6 md:gap-7";const b=document.createElement("div");b.className="flex-1",b.appendChild(u);const c=document.createElement("div");c.className="flex-1";const y=document.createElement("h2");y.className="text-xl font-bold ml-5 text-gray-800 mb-4",y.textContent=n,c.appendChild(y);const E=document.createElement("p");E.className="text-xs text-gray-700 ml-5 mb-4",E.textContent=o.length>0?`Tags: ${o.join(", ")}`:"No tags available",c.appendChild(E);const w=document.createElement("p");w.className=" text-gray-700 ml-5  mb-4",w.textContent=a,c.appendChild(w);const x=document.createElement("p");x.className=" text-gray-800 font-semibold ml-5 mb-2",x.textContent=`Seller: ${i.name||"Unknown Seller"}`,c.appendChild(x);const v=document.createElement("p");v.className=" text-gray-700 font-semibold ml-5 mb-2",v.textContent=`Created: ${l?l.slice(0,10):"Unknown Date"}`,c.appendChild(v);const C=document.createElement("p");C.className=" text-gray-700 font-semibold ml-5 mb-2",C.textContent=`Ends at: ${d?d.slice(0,10):"Unknown Date"}`,c.appendChild(C),f.appendChild(b),f.appendChild(c),e.appendChild(f);const g=document.createElement("p");g.id="bidHistory",g.className="text-sm ml-5 font-bold text-gray-600 hover:text-blue-800 mt-6 cursor-pointer hover:underline",g.textContent=`Bids: ${I.bids}`,e.appendChild(g)}function k(){const e=new URLSearchParams(window.location.search).get("post");e?fetchAndRenderSingleAuction(e):console.error("Auction ID is missing in the URL.")}document.addEventListener("DOMContentLoaded",k);async function H(t,e){if(!t||!e||e<=0)throw new Error("Invalid parameters for bid request.");const n=`${S}/${t}/bids`,a=B();try{const o=await fetch(n,{method:"POST",headers:a,body:JSON.stringify({amount:e})});if(!o.ok){const i=await o.text();throw new Error(`Failed to place bid. Status: ${o.status}, Error: ${i}`)}return{success:!0,message:"Bid placed successfully!",data:await o.json()}}catch(o){return console.error("Error placing bid:",o),{success:!1,message:o.message}}}async function U(t,e,n){const a=parseFloat(localStorage.getItem("credit"))||0,o=localStorage.getItem("token");if(!o){s("You need to log in to place a bid.","alert");return}if(!n||n<=0){s("Please enter a valid bid amount.","alert");return}if(n<=e){s(`Your bid must be higher than ${e}.`,"alert");return}if(n>a){s("You do not have enough funds to place a bid.","alert");return}try{const r=await H(t,n,o);r?s(r.message,"success"):s(`Failed to place bid: ${r.message}`,"error")}catch{s("There was an error placing your bid. Please try again.","error")}}async function T(t){const e=document.createElement("div");e.id="bidHistoryModal",e.className="fixed inset-0 bg-black bg-opacity-50 mt-20 lg:mt-30 flex justify-center items-center hidden";const n=document.createElement("div");n.className="bg-white p-4 rounded-lg w-200 max-h-[70vh] overflow-y-auto shadow-lg";const a=document.createElement("button");a.innerText="Close",a.className="text-red-500 font-semibold float-right",a.onclick=()=>e.style.display="none";const o=t.sort((r,i)=>i.amount-r.amount);n.appendChild(a),o.forEach(r=>{const i=document.createElement("div");i.className="flex justify-between items-center w-full border-b py-2 md:py-4";const m=document.createElement("div");m.className="flex items-center space-x-4";const l=document.createElement("img");l.className="w-16 h-16 rounded-full md:w-20 md:h-20",l.src=r.bidder.avatar.url||"default-avatar.png",l.alt=`${r.bidder.name}'s avatar`;const p=document.createElement("p");p.className="font-semibold",p.innerText=r.bidder.name,m.appendChild(l),m.appendChild(p);const d=document.createElement("p");d.className="semibold",d.innerHTML=`Bid : <span class="font-bold">$${r.amount}</span>`,i.appendChild(m),i.appendChild(d),n.appendChild(i)}),e.appendChild(n),document.body.appendChild(e),document.getElementById("bidHistory").addEventListener("click",()=>{e.style.display="flex"})}async function P(t){if(!t)throw new Error("Invalid auction ID");const e=`${S}/${t}`,n=B();try{const a=await fetch(e,{method:"DELETE",headers:n});if(!a.ok){const r=(await a.json()).message||"Failed to delete auction listing.";throw console.error(`Error ${a.status}: ${r}`),new Error(r)}return{success:!0,message:"Auction deleted successfully."}}catch(a){throw console.error("Error deleting auction listing:",a),a}}async function M(t){t.preventDefault();const n=t.target.dataset.id;if(!n){console.error("listID not found.");return}if(confirm("Are you sure you want to delete this list?"))try{const o=await P(n);o?(sessionStorage.setItem("deleteList",!0),window.location.href="/"):(console.error("Failed to delete list:",o.error),s("Error: Could not delete the list.","error"))}catch(o){console.error("Unexpected error:",o),s("Error: Could not delete the list.","error")}}A();D();const j=new URLSearchParams(window.location.search),h=j.get("singleList");async function F(){try{const t=await N(h);await O(t.data);const{highestBid:e}=$(t.data);document.getElementById("highestBid").textContent=`${e}$`,L(t.data),q(h),R(h),z(t.data.bids),Y(t.data),J()}catch(t){console.error("Error during auction page initialization:",t)}}async function O(t){const e=JSON.parse(localStorage.getItem("adminUser"));if(!e)return;const n=document.getElementById("adminAction");e.name!==t.seller.name?n.classList.add("hidden"):(n.classList.remove("hidden"),n.classList.add("flex"))}function q(t){const e=document.querySelector(".del-btn");e&&(e.setAttribute("data-id",t),e.addEventListener("click",M))}function R(t){const e=document.querySelector(".edit-btn");e&&e.addEventListener("click",()=>{window.location.href=`/post/edit/?post=${t}`})}function z(t){const e=document.getElementById("bidHistory");e.addEventListener("click",()=>{T(t)}),localStorage.getItem("trigger")==="true"&&(e?e.click():console.warn("Bid history button not found"),localStorage.removeItem("trigger"))}function Y(t){document.getElementById("placeBid").addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("bid-amount").value,a=parseInt(n,10);let o=parseFloat(localStorage.getItem("credit"))||0;if(!a||a<=0){console.error("Invalid bid amount"),s("Please enter a valid bid amount","error");return}await U(h,t.highestBid,a),o-=a,localStorage.setItem("credit",o)})}function J(){sessionStorage.getItem("updatedSuccess")==="true"&&(s("List has been updated successfully","success"),sessionStorage.removeItem("updatedSuccess"))}F();

import{s as w,o as y}from"./hamburgerMenu-Mj8nOhEq.js";import{p as u}from"./authUtils-BlpDD4MX.js";import{a as p}from"./constants-BFXYqvjv.js";import{g}from"./higherBider-DIwdkbzu.js";import{t as h}from"./toastMsg-pxLBbmNp.js";async function E(r){if(!r)throw new Error("The 'name' parameter is required.");const e=`${p}/${r}/bids?_listings=true`;try{const n=u(),t=await fetch(e,{method:"GET",headers:n});if(!t.ok){const o=(await t.json()).message||`Error fetching bids: ${t.statusText}`;throw console.error(`Error ${t.status}: ${o}`),new Error(o)}const a=await t.json();if(!a||!a.data)throw new Error("Invalid response data. No 'data' field in the response.");return a}catch(n){throw console.error("Error fetching auction bids:",n.message||n),n}}async function x(r){const e=document.getElementById("myBids");e.innerHTML="",r.forEach(n=>{const t=document.createElement("div");t.classList.add("flex","flex-col","sm:flex-row","justify-between","space-y-4","sm:space-y-0","p-4","bg-blue-100","border","border-gray-300","rounded-lg","shadow-lg");const a=document.createElement("div");a.classList.add("flex","flex-col","sm:flex-col","justify-center","items-center","sm:items-start","space-y-2","sm:space-y-0");const s=document.createElement("h3");s.textContent=n.listing.title||"Untitled Auction",s.classList.add("font-semibold","text-xs");const o=document.createElement("img");o.src=n.listing.media[0]?.url||"",o.alt=n.listing.media[0]?.alt||"Image",o.classList.add("w-20","h-20","object-cover","rounded-lg","sm:mr-4"),a.appendChild(s),a.appendChild(o);const i=document.createElement("div");i.classList.add("flex","flex-row","items-center","sm:items-start","space-y-2");const d=document.createElement("p");d.textContent=`Bid: $${n.amount||"0.00"}`,d.classList.add("text-sm","font-semibold","text-blue-800"),i.appendChild(d),t.appendChild(a),t.appendChild(i),e.appendChild(t)})}async function b(){const r=JSON.parse(localStorage.getItem("adminUser"));try{const e=await E(r.name);if(!e)throw new Error("Failed to fetch bids.");x(e.data)}catch(e){console.error("Error fetching bids:",e)}}async function v(r){const e=`${p}/${r}/listings?_bids=true`;try{const n=u(),t=await fetch(e,{method:"GET",headers:n});if(!t.ok)throw new Error(`Error fetching listings: ${t.statusText}`);return await t.json()}catch(n){throw console.error("Error:",n),n}}async function C(r){const e=document.getElementById("auctionContainer");e.innerHTML="";const n=document.createDocumentFragment();r.forEach(t=>{const a=document.createElement("section");a.className="flex flex-col w-full bg-gray-300 border-2 border-gray-400 p-4";const s=document.createElement("h3");s.className="font-bold",s.textContent=t.title||"Untitled Auction";const o=document.createElement("div");o.className="flex flex-col sm:flex-row gap-2 relative w-full";const i=document.createElement("img");i.className="w-20 h-20",i.src=t.media[0]?.url||"path/to/placeholder-image.jpg",i.alt=t.media[0]?.alt||"Item Image",i.loading="lazy";const{highestBid:d}=g(t),c=document.createElement("div");c.className="flex flex-col gap-2";const l=document.createElement("p");l.textContent=t.description||"No description available.";const f=document.createElement("p");f.className="font-semibold text-blue-900",f.textContent=`Price: $${d||"0.00"}`,c.appendChild(l),c.appendChild(f);const m=document.createElement("button");m.type="button",m.textContent="View auction",m.className="static md:absolute cursor-pointer px-4 py-2 hover:bg-blue-600 md:right-8 md:top-1/2 md:-translate-y-1/2 bg-blue-gray w-fit p-2 m-auto font-semibold text-white border-2",m.addEventListener("click",()=>{window.location.href=`/post/index.html?singleList=${t.id}`}),o.appendChild(i),o.appendChild(c),o.appendChild(m),a.appendChild(s),a.appendChild(o),n.appendChild(a)}),e.appendChild(n)}async function I(){const r=JSON.parse(localStorage.getItem("adminUser"));try{const e=await v(r.name);if(!e)throw new Error("Failed to fetch listings.");C(e.data)}catch(e){console.error("Error fetching listings:",e)}}async function L(r){if(!r)throw new Error("User name is required to fetch won auctions.");const e=`${p}/${r}/wins?_bids=true`;try{const n=u(),t=await fetch(e,{method:"GET",headers:n});if(!t.ok){const o=(await t.json()).message||"Failed to fetch won auctions.";throw console.error(`Error fetching won auctions for user "${r}": ${o}`),new Error(o)}const a=await t.json();if(!a||!a.data)throw new Error("Invalid response data: Missing 'data' field.");return a.data}catch(n){throw console.error("Error fetching won auctions:",n.message||n),n}}async function $(r){const e=document.getElementById("winList");if(e.innerHTML="",r.length===0){e.className="w-full h-20 bg-red-500 text-white flex justify-center items-center",e.textContent="Sorry you havenâ€™t won anything yet";return}const n=document.createDocumentFragment();r.forEach(t=>{const a=document.createElement("div");a.classList.add("flex","flex-col","sm:flex-row","mb-8","border","rounded-lg","shadow-md","bg-teal-100","p-4","space-y-4","sm:space-y-0","sm:space-x-6","sm:items-center");const s=document.createElement("div");s.classList.add("flex","flex-col","sm:flex-row","sm:items-center","sm:space-x-4","w-full");const o=document.createElement("h3");o.classList.add("font-bold","text-gray-800"),o.innerText=t.title||"Untitled Auction";const i=document.createElement("img");i.src=t.media[0]?.url||"path/to/placeholder-image.jpg",i.alt=t.media[0]?.alt||"Auction Image",i.classList.add("w-32","h-32","sm:w-32","sm:h-32","rounded-lg","object-cover","mb-4","sm:mb-0"),i.loading="lazy",s.appendChild(o),s.appendChild(i);const{highestBid:d}=g(t),c=document.createElement("div");c.classList.add("text-gray-700","font-medium","sm:ml-auto","mt-4","sm:mt-0");const l=document.createElement("p");l.classList.add("text-sm","font-semibold","text-blue-700"),l.textContent=`Won for: $${d||"0.00"}`,c.appendChild(l),a.appendChild(s),a.appendChild(c),n.appendChild(a)}),e.appendChild(n)}async function D(){const r=JSON.parse(localStorage.getItem("adminUser"));try{const e=await L(r.name);if(!e)throw new Error("Failed to fetch winning auctions.");$(e.data)}catch(e){console.error("Error fetching winning auctions:",e)}}async function B(r,e){if(!r||!e)throw new Error("Both 'name' and 'avatarUrl' are required to update the profile.");const n=`${p}/${r}`,t={avatar:{url:e,alt:"User avatar"}};try{const a=u(),s=await fetch(n,{method:"PUT",headers:a,body:JSON.stringify(t)});if(!s.ok){const c=(await s.json()).message||"Failed to update profile.";throw console.error(`Error ${s.status}: ${c}`),new Error(c)}const o=await s.json();if(!o||!o.data)throw new Error("Invalid response data: Missing 'data' field.");const i=o.data;return localStorage.setItem("adminUser",JSON.stringify(i)),o}catch(a){return console.error("Error updating profile:",a.message||a),alert("There was an error updating your profile. Please try again."),null}}async function N(r){r.preventDefault();const e=document.getElementById("profileAvatar").value,n=JSON.parse(localStorage.getItem("adminUser"));if(!e){h("Please fill out the required field.","alert");return}try{await B(n.name,e)&&h("Profile updated successfully!","success")}catch(t){console.error("Error updating profile:",t),h("Failed to update profile.","error")}}async function U(){const r=JSON.parse(localStorage.getItem("adminUser")),e=localStorage.getItem("credit");document.getElementById("avatar").src=r.avatar.url,document.getElementById("profileName").textContent=r.name,document.getElementById("wallet").textContent=`${e}$`}function S(){try{w(),U(),D(),I(),b(),document.getElementById("profileUpdate").addEventListener("submit",N),document.getElementById("logout-Btn").addEventListener("click",y)}catch(r){console.error("Error initializing profile page:",r)}}S();

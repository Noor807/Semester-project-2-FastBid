import{f as D}from"./singleListRead-2w0x1GBA.js";import{u as k}from"./loginAdmin-CrNTEl2x.js";import{A as N,b as $}from"./constants-D-ym1ySC.js";import{p as H}from"./authUtils-Bs7pnOI2.js";import{t as i}from"./toastMsg-pxLBbmNp.js";import{g as P}from"./higherBider-DIwdkbzu.js";import"./logout-Bp4xtVrQ.js";function T(o){const t=document.querySelector("#AuctionDetailContainer");if(!t){console.error('No element with id "AuctionDetailContainer" found.');return}const{title:e="Untitled Auction",description:s="No description available",tags:a=[],media:n=[],seller:r="unknown",bids:m="0",created:l="Date",updated:p="Date",endsAt:d="Date",_count:L={bids:0}}=o||{};t.innerHTML="";const g=document.createElement("img");n&&n.length>0&&(g.src=n[0].url||"",g.alt=n[0].alt||"No description"),g.className="w-full h-96 object-cover mb-6";const f=document.createElement("div");f.className="flex flex-col md:flex-row gap-6 md:gap-7";const y=document.createElement("div");y.className="flex-1",y.appendChild(g);const c=document.createElement("div");c.className="flex-1";const E=document.createElement("h2");E.className="text-xs font-bold ml-5 text-gray-800 mb-4",E.textContent=e,c.appendChild(E);const w=document.createElement("p");w.className="text-xs text-gray-700 ml-5 mb-4",w.textContent=a.length>0?`Tags: ${a.join(", ")}`:"No tags available",c.appendChild(w);const x=document.createElement("p");x.className=" text-gray-700 ml-5  mb-4",x.textContent=s,c.appendChild(x);const C=document.createElement("p");C.className=" text-gray-800 font-semibold ml-5 mb-2",C.textContent=`Seller: ${r.name||"Unknown Seller"}`,c.appendChild(C);const v=document.createElement("p");v.className=" text-gray-700 font-semibold ml-5 mb-2",v.textContent=`Created: ${l?l.slice(0,10):"Unknown Date"}`,c.appendChild(v);const I=document.createElement("p");I.className=" text-gray-700 font-semibold ml-5 mb-2",I.textContent=`Ends at: ${d?d.slice(0,10):"Unknown Date"}`,c.appendChild(I),f.appendChild(y),f.appendChild(c),t.appendChild(f);const h=document.createElement("p");h.id="bidHistory",h.className="text-sm ml-5 font-bold text-gray-600 hover:text-blue-800 mt-6 cursor-pointer hover:underline",h.textContent=`Bids: ${L.bids}`,t.appendChild(h)}function U(){const t=new URLSearchParams(window.location.search).get("post");t?fetchAndRenderSingleAuction(t):console.error("Auction ID is missing in the URL.")}document.addEventListener("DOMContentLoaded",U);async function j(o,t){if(!o||!t||t<=0)throw new Error("Invalid parameters for bid request.");const e=`${N}/${o}/bids`,s=H();try{const a=await fetch(e,{method:"POST",headers:s,body:JSON.stringify({amount:t})});if(!a.ok){const r=await a.text();throw new Error(`Failed to place bid. Status: ${a.status}, Error: ${r}`)}return{success:!0,message:"Bid placed successfully!",data:await a.json()}}catch(a){return console.error("Error placing bid:",a),{success:!1,message:a.message}}}async function F(o,t,e){const s=parseFloat(localStorage.getItem("credit"))||0,a=localStorage.getItem("token");if(!a){i("You need to log in to place a bid.","alert");return}if(!e||e<=0){i("Please enter a valid bid amount.","alert");return}if(e<=t){i(`Your bid must be higher than ${t}.`,"alert");return}if(e>s){i("You do not have enough funds to place a bid.","alert");return}try{const n=await j(o,e,a);n?i(n.message,"success"):i(`Failed to place bid: ${n.message}`,"error")}catch{i("There was an log placing your bid. Please try again.","error")}}async function M(o){const t=document.createElement("div");t.id="bidHistoryModal",t.className="fixed inset-0 bg-black bg-opacity-50 mt-20 lg:mt-30 flex justify-center items-center hidden";const e=document.createElement("div");e.className="bg-white p-4 rounded-lg w-200 max-h-[70vh] overflow-y-auto shadow-lg";const s=document.createElement("button");s.innerText="Close",s.className="text-red-500 font-semibold float-right",s.onclick=()=>t.style.display="none";const a=o.sort((n,r)=>r.amount-n.amount);e.appendChild(s),a.forEach(n=>{const r=document.createElement("div");r.className="flex justify-between items-center w-full border-b py-2 md:py-4";const m=document.createElement("div");m.className="flex items-center space-x-4";const l=document.createElement("img");l.className="w-16 h-16 rounded-full md:w-20 md:h-20",l.src=n.bidder.avatar.url||"default-avatar.png",l.alt=`${n.bidder.name}'s avatar`;const p=document.createElement("p");p.className="font-semibold",p.innerText=n.bidder.name,m.appendChild(l),m.appendChild(p);const d=document.createElement("p");d.className="semibold",d.innerHTML=`Bid : <span class="font-bold">$${n.amount}</span>`,r.appendChild(m),r.appendChild(d),e.appendChild(r)}),t.appendChild(e),document.body.appendChild(t),document.getElementById("bidHistory").addEventListener("click",()=>{t.style.display="flex"})}async function O(o,t){try{const e=`${N}/${o}`,s={"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Noroff-API-Key":$},a=await fetch(e,{method:"DELETE",headers:s});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to delete auction listing.")}return{success:!0,message:"Post deleted successfully"}}catch(e){throw console.error("Error deleting auction listing:",e),e}}async function q(o){o.preventDefault();const e=o.target.dataset.id,s=localStorage.getItem("token");if(!e){console.error("listID not found.");return}if(confirm("Are you sure you want to delete this list?"))try{const n=await O(e,s);n?(sessionStorage.setItem("deleteList",!0),window.location.href="/"):(console.error("Failed to delete list:",n.error),i("Error: Could not delete the list.","error"))}catch(n){console.error("Unexpected error:",n),i("Error: Could not delete the list.","error")}}k();const R=new URLSearchParams(window.location.search),u=R.get("singleList"),b=await D(u);async function Y(o){const t=JSON.parse(localStorage.getItem("adminUser"));if(!t)return;const e=document.getElementById("adminAction");t.name!==o.seller.name?e.classList.add("hidden"):(e.classList.remove("hidden"),e.classList.add("flex"))}Y(b.data);const{highestBid:A}=P(b.data);document.getElementById("highestBid").textContent=`${A}$`;T(b.data);const S=document.querySelector(".del-btn");S&&(S.setAttribute("data-id",u),S.addEventListener("click",q));const B=document.querySelector(".edit-btn");B&&B.addEventListener("click",()=>{window.location.href=`/post/edit/?post=${u}`});const _=document.getElementById("bidHistory");_.addEventListener("click",M(b.data.bids));const J=document.getElementById("hamburger-btn"),K=document.getElementById("navbar-links");J.addEventListener("click",()=>{K.classList.toggle("hidden")});const z=localStorage.getItem("trigger");if(z==="true"){const o=document.getElementById("bidHistory");o?o.click():console.warn("Bid history button not found"),localStorage.removeItem("trigger")}document.getElementById("placeBid").addEventListener("submit",async o=>{o.preventDefault();let t=document.getElementById("bid-amount").value;const e=parseInt(t,10);let s=parseFloat(localStorage.getItem("credit"))||0;if(!u||!e){console.error("Post ID or bid amount is missing");return}await F(u,A,e),s-=e,localStorage.setItem("credit",s)});sessionStorage.getItem("updatedSuccess")==="true"&&(i("List has been updated successfully","success"),sessionStorage.removeItem("updatedSuccess"));
